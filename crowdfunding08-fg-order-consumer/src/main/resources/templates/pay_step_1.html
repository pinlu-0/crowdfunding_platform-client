<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<!-- 引入公共的header -->
<head th:replace="common/js_file :: head(~{::title})"></head>
<title>pay_step_1</title>


<!-- 引入公共的样式 -->
<style th:replace="common/css_file :: cssstyle"></style>

<!-- 本页面独有的样式 -->
<style>
    td {
        vertical-align: middle; /*垂直居中*/
        text-align: center; /*上下居中*/
    }
</style>


<body>

<!-- 引入公共的header -->
<div th:replace="common/header :: header"></div>

<div class="container theme-showcase" role="main">

    <div class="container">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div class="panel panel-default">
                    <div class="panel-heading" style="text-align:center;">
                        <div class="container-fluid">
                            <div class="row clearfix">
                                <div class="col-md-3 column">
                                    <div class="progress"
                                         style="height:50px;border-radius:0;    position: absolute;width: 75%;right:49px;">
                                        <div class="progress-bar progress-bar-success" role="progressbar"
                                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                                             style="width: 100%;height:50px;">
                                            <div style="font-size:16px;margin-top:15px;">1. 确认回报内容</div>
                                        </div>
                                    </div>
                                    <div style="right: 0;border:10px solid #ddd;border-left-color: #88b7d5;border-width: 25px;position: absolute;
                                             border-left-color: rgba(92, 184, 92, 1);
                                             border-top-color: rgba(92, 184, 92, 0);
                                             border-bottom-color: rgba(92, 184, 92, 0);
                                             border-right-color: rgba(92, 184, 92, 0);
                                        ">
                                    </div>
                                </div>
                                <div class="col-md-3 column">
                                    <div class="progress"
                                         style="height:50px;border-radius:0;position: absolute;width: 75%;right:49px;">
                                        <div class="progress-bar progress-bar-default" role="progressbar"
                                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                                             style="width: 100%;height:50px;">
                                            <div style="font-size:16px;margin-top:15px;">2. 确认订单</div>
                                        </div>
                                    </div>
                                    <div style="right: 0;border:10px solid #ddd;border-left-color: #88b7d5;border-width: 25px;position: absolute;
                                             border-left-color: rgba(221, 221, 221, 1);
                                             border-top-color: rgba(221, 221, 221, 0);
                                             border-bottom-color: rgba(221, 221, 221, 0);
                                             border-right-color: rgba(221, 221, 221, 0);
                                        ">
                                    </div>
                                </div>
                                <div class="col-md-3 column">
                                    <div class="progress"
                                         style="height:50px;border-radius:0;position: absolute;width: 75%;right:49px;">
                                        <div class="progress-bar progress-bar-default" role="progressbar"
                                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                                             style="width: 100%;height:50px;">
                                            <div style="font-size:16px;margin-top:15px;">3. 付款</div>
                                        </div>
                                    </div>
                                    <div style="right: 0;border:10px solid #ddd;border-left-color: #88b7d5;border-width: 25px;position: absolute;
                                             border-left-color: rgba(221, 221, 221, 1);
                                             border-top-color: rgba(221, 221, 221, 0);
                                             border-bottom-color: rgba(221, 221, 221, 0);
                                             border-right-color: rgba(221, 221, 221, 0);
                                        ">
                                    </div>
                                </div>
                                <div class="col-md-3 column">
                                    <div class="progress" style="height:50px;border-radius:0;">
                                        <div class="progress-bar progress-bar-default" role="progressbar"
                                             aria-valuenow="60" aria-valuemin="0" aria-valuemax="100"
                                             style="width: 100%;height:50px;">
                                            <div style="font-size:16px;margin-top:15px;">4. 完成</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="container-fluid">
                            <div class="row clearfix">
                                <div class="col-md-12 column">
                                    <blockquote style="border-left: 5px solid #f60;color:#f60;padding: 0 0 0 20px;">
                                        <b>
                                            请确认您所选择的回报项信息和购买数量
                                        </b>
                                    </blockquote>
                                </div>
                                <div class="col-md-12 column">
                                    <table class="table table-bordered" style="text-align:center;">
                                        <thead>
                                        <tr style="background-color:#ddd;">
                                            <td>项目名称</td>
                                            <td>发起人</td>
                                            <td width="300">回报内容</td>
                                            <td width="80">回报数量</td>
                                            <td>支持单价</td>
                                            <td>配送费用</td>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td th:text="${session.orderProjectVO.projectName}">此处显示项目名称</td>
                                            <td th:text="${session.orderProjectVO.launchName}">此处显示发起人</td>
                                            <td th:text="${session.orderProjectVO.returnContent}">此处显示回报内容</td>
                                            <td>
                                                <!-- 显示回报的数量 -->
                                                <input type="text" id="returnCountInput" class="form-control"
                                                       style="width:60px;"
                                                       th:value="${session.orderProjectVO.returnCount}">
                                            </td>
                                            <td style="color:#F60" th:text="${session.orderProjectVO.supportPrice}">
                                                此处显示支持单价
                                            </td>
                                            <td th:if="${session.orderProjectVO.freight==0}" th:text="免运费">
                                                此处显示回报数量显示配送费用
                                            </td>
                                            <td th:if="${session.orderProjectVO.freight!=0}"
                                                th:text="${session.orderProjectVO.freight}">此处显示回报数量显示配送费用
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <div style="float:right;">
                                        <p>总价(含运费)：<span id="totalPrices" style="font-size:16px;color:#F60;">[[${session.orderProjectVO.freight + (session.orderProjectVO.returnCount * session.orderProjectVO.supportPrice)}]]</span>
                                        </p>
                                        <button id="toSettleBtn" type="button" class="btn btn-warning btn-lg"
                                                style="float:right;">
                                            <i class="glyphicon glyphicon-credit-card"></i> 去结算
                                        </button>
                                    </div>
                                </div>

                                <div class="container">
                                    <div class="row clearfix">
                                        <div class="col-md-12 column">
                                            <blockquote>
                                                <p>
                                                    <i class="glyphicon glyphicon-info-sign" style="color:#2a6496;"></i>
                                                    提示
                                                </p><br>
                                                <span style="font-size:12px;">1.众筹并非商品交易，存在一定风险。支持者根据自己的判断选择、支持众筹项目，与发起人共同实现梦想并获得发起人承诺的回报。<br>
                                2.众筹平台仅提供平台网络空间及技术支持等中介服务，众筹仅存在于发起人和支持者之间，使用众筹平台产生的法律后果由发起人与支持者自行承担。<br>
                                3.本项目必须在2017-06-04之前达到 ￥1000000.00 的目标才算成功，否则已经支持的订单将取消。订单取消或募集失败的，您支持的金额将原支付路径退回。<br>
                                4.请在支持项目后15分钟内付款，否则您的支持请求会被自动关闭。<br>
                                5.众筹成功后由发起人统一进行发货，售后服务由发起人统一提供；如果发生发起人无法发放回报、延迟发放回报、不提供回报后续服务等情况，您需要直接和发起人协商解决。<br>
                                6.如您不同意上述风险提示内容，您有权选择不支持；一旦选择支持，视为您已确认并同意以上提示内容。</span>
                                            </blockquote>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- footer -->
    <div class="container" style="margin-top:20px;">
        <div class="row clearfix">
            <div class="col-md-12 column">
                <div id="footer">
                    <div class="footerNav">
                        <a rel="nofollow" href="http://www.atguigu.com">关于我们</a> | <a rel="nofollow"
                                                                                      href="http://www.atguigu.com">服务条款</a>
                        | <a rel="nofollow" href="http://www.atguigu.com">免责声明</a> | <a rel="nofollow"
                                                                                        href="http://www.atguigu.com">网站地图</a>
                        | <a rel="nofollow" href="http://www.atguigu.com">联系我们</a>
                    </div>
                    <div class="copyRight">
                        Copyright ?2010-2014atguigu.com 版权所有
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 脚本语言 -->
<script type="text/javascript" th:inline="javascript">


    $('#myTab a').click(function (e) {
        e.preventDefault()
        $(this).tab('show')
    });

    var signalPurchase = [[${session.orderProjectVO.signalPurchase}]];
    var freight = [[${session.orderProjectVO.freight}]];
    var purchase = [[${session.orderProjectVO.purchase}]];
    var supportPrice = [[${session.orderProjectVO.supportPrice}]];
    console.log("signalPurchase：" + signalPurchase + ", freight ：" + freight + ", purchase：" + purchase + ", supportPrice：" + supportPrice);


    /* 回报数量值的改变事件 */
    $("#returnCountInput").change(function () {

        // 获取输入的回报数量
        var returnCount = $.trim($(this).val());

        // 校验非空性
        if (returnCount.length == 0 || returnCount == null) {
            layer.msg("请输入回报数量");
            $(this).val(this.defaultValue);
            return false;
        }
        // 非负正整数正则表达式
        var pattern = /^[1-9]\d*$/;
        // 校验输入的是否是数字
        if (!pattern.test(returnCount)) {
            layer.msg("请输入有效数据");
            $(this).val(this.defaultValue);
            return false;
        }

        // 校验数据合法性
        if (signalPurchase == 1 && returnCount > purchase) {
            layer.msg("对不起，您输入的数量已超过最大回报限额数");
            $(this).val(this.defaultValue);
            return false;
        }
        // 根据回报数量动态改变总价
        $("#totalPrices").text("￥" + (freight + supportPrice * returnCount));
    });


    /* 点击去结算按钮 */
    $("#toSettleBtn").click(function () {
        var returnCount = $.trim($("#returnCountInput").val());

        window.location.href = "order/to/pay_step_2/" + returnCount;
    });

</script>
</body>
</html>